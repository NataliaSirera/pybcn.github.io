{% macro sponsors(node) %}
    <h2>
        <i class="fa fa-rocket" aria-hidden="true"></i>
        Sponsors and collaborators
    </h2>
    <div class="col-md-12">
        <h3 class="venues"">
            <i class="fa fa-university" aria-hidden="true"></i>
            Venues
        </h3>
        {{ sponsors_by_level(node, 'venue') }}
    </div>
    <div class="col-md-12">
        <h3 class="platinum">
            <i class="fa fa-certificate" aria-hidden="true"></i>
            Platinum
        </h3>
        {{ sponsors_by_level(node, 'platinum') }}
    </div>
    <div class="col-md-12">
        <h3 class="gold">
            <i class="fa fa-certificate" aria-hidden="true"></i>
            Gold
        </h3>
        {{ sponsors_by_level(node, 'gold') }}
    </div>
    <div class="col-md-12">
        <h3 class="silver">
            <i class="fa fa-certificate" aria-hidden="true"></i>
            Silver
        </h3>
        {{ sponsors_by_level(node, 'silver') }}
    </div>
    <div class="col-md-12">
        <h3 class="collaborators">
            <i class="fa fa-cube" aria-hidden="true"></i>
            Collaborators
        </h3>
        {{ sponsors_by_level(node, 'collaborator', 160) }}
    </div>
    <div class="col-md-12">
        <h3 class="thanks-to">
            <i class="fa fa-thumbs-o-up" aria-hidden="true"></i>
            Thanks to ...
        </h3>
        {{ sponsors_by_level(node, 'thanks', 160) }}
    </div>
{% endmacro %}

{% macro sponsors_by_level(node, level, size = 320) %}
    <ul class="sponsors">
    {% for child in node.children.filter((F._model == 'sponsor').and(F.level == level)) %}
        <li>
            <a href="{{ child|url }}">
                <img src="{{ child.attachments.images.first().thumbnail(size)|url }}" alt="{{ child.name }}" />
            </a>
        </li>
    {% endfor %}
    </ul>
{% endmacro %}

{% macro sponsor_has_jobs(sponsor) %}
    {{ sponsor.children.filter(F._model == 'job_offer').first().title }}
{% endmacro %}

{% macro jobs_from_sponsor(node, current_node) %}
    {% set job_offers = node.children.filter(F._model == 'job_offer') %}
    {% if job_offers %}
        <ul>
        {% for job_offer in job_offers %}
            <li>
                <a href="{{ job_offer._path }}">
                    {{ job_offer.title }}
                    {% if current_node != node %}
                        at {{ node.name }}
                    {% endif %}
                </a>
            </li>
        {% endfor %}
        </ul>
    {% endif %}
{% endmacro %}

{% macro get_jobs_from_sponsors(node, levels) %}
    {% for level in levels %}
        {% for sponsor in node.children.filter(F._model == 'sponsor' and F.level == level) %}
            {{ jobs_from_sponsor(sponsor, node) }}
        {% endfor %}
    {% endfor %}
{% endmacro %}

{% macro sponsors_have_jobs(node, levels) %}
    {% for sponsor in node.children.filter(F._model == 'sponsor') %}
        {% if sponsor.level in levels and sponsor.children.filter(F._model == 'job_offer').first().title %}
            {{ sponsor.children.filter(F._model == 'job_offer').first().title }}
        {% endif %}
    {% endfor %}
{% endmacro %}

{% macro jobs_from_sponsors(node) %}
    {% set levels = ['platinum', 'gold', 'silver', 'bronze'] %}
    {% if sponsors_have_jobs(node, levels)|trim %}
        <div class="row event-sponsors-jobs">
            <div class="col-md-12">
                <div class="widget">
                    <h2>
                        <i class="fa fa-industry" aria-hidden="true"></i>
                        Job Offers from our sponsors
                    </h2>
                    <div class="col-md-12">
                        {{ get_jobs_from_sponsors(node, levels) }}
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
{% endmacro %}
